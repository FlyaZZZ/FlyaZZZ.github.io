<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>ECharts Map Example</title>
    <script src="https://cdn.jsdelivr.net/npm/jquery"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-array"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-geo"></script>
    <link rel="shortcut icon" href="favicon.ico" />

    <style>
        #main {
            width: 800px;
            height: 600px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
    </style>
</head>

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>数据可视化</title>
    <!-- ctrl+h即可调出查询与替换窗口 -->
</head>



<body>
    <div id="navbar-container">
        <!-- 导航栏 -->
    </div>

    <script>
        // 使用 JavaScript 加载导航栏内容
        window.addEventListener('DOMContentLoaded', function () {
            var navbarContainer = document.getElementById('navbar-container');
            var xhr = new XMLHttpRequest();
            xhr.open('GET', './navgeo.html', true);
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    navbarContainer.innerHTML = xhr.responseText;
                }
            };
            xhr.send();
        });
    </script>

    <div id="main" style="width: 800px; height: 400px;"></div>
    <script>
        var ROOT_PATH = 'https://echarts.apache.org/examples';

        var chartDom = document.getElementById('main');
        var myChart = echarts.init(chartDom);
        var option;

        $.get('../static/json/life-expectancy-table.json', function (_rawData) {
            run(_rawData);
        });

        function run(_rawData) {
            // var countries = ['Australia', 'Canada', 'China', 'Cuba', 'Finland', 'France', 'Germany', 'Iceland', 'India', 'Japan', 'North Korea', 'South Korea', 'New Zealand', 'Norway', 'Poland', 'Russia', 'Turkey', 'United Kingdom', 'United States'];
            const countries = [
                'California', 'Texas', 'Illinois', 'Pennsylvania', 'Florida', 'New York'
            ];
            const datasetWithFilters = [];
            const seriesList = [];
            echarts.util.each(countries, function (country) {
                var datasetId = 'dataset_' + country;
                datasetWithFilters.push({
                    id: datasetId,
                    fromDatasetId: 'dataset_raw',
                    transform: {
                        type: 'filter',
                        config: {
                            and: [
                                { dimension: 'Year', gte: 2014 },
                                { dimension: 'Country', '=': country }
                            ]
                        }
                    }
                });
                seriesList.push({
                    type: 'line',
                    datasetId: datasetId,
                    showSymbol: false,
                    name: country,
                    endLabel: {
                        show: true,
                        formatter: function (params) {
                            return params.value[1] + ': ' + params.value[0];
                        }
                    },
                    labelLayout: {
                        moveOverlap: 'shiftY'
                    },
                    emphasis: {
                        focus: 'series'
                    },
                    encode: {
                        x: 'Year',
                        y: 'Income',
                        label: ['Country', 'Income'],
                        itemName: 'Year',
                        tooltip: ['Income']
                    }
                });
            });
            option = {
                animationDuration: 10000,
                dataset: [
                    {
                        id: 'dataset_raw',
                        source: _rawData
                    },
                    ...datasetWithFilters
                ],
                title: {
                    text: 'Income of Germany and France since 1950'
                },
                tooltip: {
                    order: 'valueDesc',
                    trigger: 'axis'
                },
                xAxis: {
                    type: 'category',
                    nameLocation: 'middle'
                },
                yAxis: {
                    name: 'Income'
                },
                grid: {
                    right: 140
                },
                series: seriesList
            };
            myChart.setOption(option);
        }

        option && myChart.setOption(option);

    </script>

</body>

</html>