<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>热图</title>
    <script src="https://cdn.jsdelivr.net/npm/jquery"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-array"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-geo"></script>
    <link rel="shortcut icon" href="favicon.ico" />
    <style>
        #main {
            width: 800px;
            height: 600px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
    </style>
</head>

<body>
    <div id="navbar-container">
        <!-- 导航栏 -->
    </div>

    <script>
        // 使用 JavaScript 加载导航栏内容
        window.addEventListener('DOMContentLoaded', function () {
            var navbarContainer = document.getElementById('navbar-container');
            var xhr = new XMLHttpRequest();
            xhr.open('GET', './navgeo.html', true);
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    navbarContainer.innerHTML = xhr.responseText;
                }
            };
            xhr.send();
        });
    </script>

    <div id="main" style="width: 1000px; height: 500px;"></div>
    <script>
        var ROOT_PATH = 'https://echarts.apache.org/examples';

        var chartDom = document.getElementById('main');
        var myChart = echarts.init(chartDom);
        var option;

        myChart.showLoading();
        $.when(
            $.get('../static/json/USA.json'),
            $.getScript('https://cdn.jsdelivr.net/npm/d3-array@3.0.0/dist/d3-array.min.js'),
            $.getScript('https://cdn.jsdelivr.net/npm/d3-geo@2.0.0/dist/d3-geo.min.js')
        ).done(function (res) {
            const usaJson = res[0];
            const projection = d3.geoAlbersUsa();
            myChart.hideLoading();
            echarts.registerMap('USA', usaJson);
            option = {
                title: {
                    text: '美国枪支暴力案数据统计',
                    subtext: 'Data from www.gunviolencearchive.org',
                    sublink: 'https://www.gunviolencearchive.org/',
                    left: 'center'

                },
                visualMap: {
                    left: 'right',
                    min: 0,
                    max: 1500,
                    inRange: {
                        color: [
                            '#313695',
                            '#4575b4',
                            '#74add1',
                            '#abd9e9',
                            '#e0f3f8',
                            '#ffffbf',
                            '#fee090',
                            '#fdae61',
                            '#f46d43',
                            '#d73027',
                            '#a50026'
                        ]
                    },
                    text: ['High', 'Low'],
                    calculable: true
                },
                toolbox: {
                    show: true,
                    //orient: 'vertical',
                    left: 'left',
                    top: 'top',
                    feature: {
                        dataView: { readOnly: false },
                        restore: {},
                        saveAsImage: {}
                    }
                },
                series: [
                    {
                        name: 'USA PopEstimates',
                        type: 'map',
                        map: 'USA',
                        projection: {
                            project: function (point) {
                                return projection(point);
                            },
                            unproject: function (point) {
                                return projection.invert(point);
                            }
                        },
                        emphasis: {
                            label: {
                                show: true
                            }
                        },
                        data: [
                            { name: 'Alabama', value: 482 },
                            { name: 'Alaska', value: 61 },
                            { name: 'Arizona', value: 308 },
                            { name: 'Arkansas', value: 239 },
                            { name: 'California', value: 1395 },
                            { name: 'Colorado', value: 251 },
                            { name: 'Connecticut', value: 166 },
                            { name: 'Delaware', value: 99 },
                            { name: 'District of Columbia', value: 196 },
                            { name: 'Florida', value: 1202 },
                            { name: 'Georgia', value: 760 },
                            { name: 'Hawaii', value: 29 },
                            { name: 'Idaho', value: 43 },
                            { name: 'Illinois', value: 1162 },
                            { name: 'Indiana', value: 504 },
                            { name: 'Iowa', value: 118 },
                            { name: 'Kansas', value: 171 },
                            { name: 'Kentucky', value: 287 },
                            { name: 'Louisiana', value: 783 },
                            { name: 'Maine', value: 51 },
                            { name: 'Maryland', value: 547 },
                            { name: 'Massachusetts', value: 293 },
                            { name: 'Michigan', value: 503 },
                            { name: 'Minnesota', value: 131 },
                            { name: 'Mississippi', value: 345 },
                            { name: 'Missouri', value: 600 },
                            { name: 'Montana', value: 41 },
                            { name: 'Nebraska', value: 97 },
                            { name: 'Nevada', value: 156 },
                            { name: 'New Hampshire', value: 44 },
                            { name: 'New Jersey', value: 332 },
                            { name: 'New Mexico', value: 161 },
                            { name: 'New York', value: 657 },
                            { name: 'North Carolina', value: 743 },
                            { name: 'North Dakota', value: 20 },
                            { name: 'Ohio', value: 800 },
                            { name: 'Oklahoma', value: 227 },
                            { name: 'Oregon', value: 146 },
                            { name: 'Pennsylvania', value: 838 },
                            { name: 'Rhode Island', value: 39 },
                            { name: 'South Carolina', value: 554 },
                            { name: 'South Dakota', value: 24 },
                            { name: 'Tennessee', value: 671 },
                            { name: 'Texas', value: 1426 },
                            { name: 'Utah', value: 83 },
                            { name: 'Vermont', value: 30 },
                            { name: 'Virginia', value: 511 },
                            { name: 'Washington', value: 218 },
                            { name: 'West Virginia', value: 121 },
                            { name: 'Wisconsin', value: 309 },
                            { name: 'Wyoming', value: 15 }
                        ]
                    }
                ]
            };
            myChart.setOption(option);
        });

        option && myChart.setOption(option);

    </script>

</body>

</html>