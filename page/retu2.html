<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>热图</title>
    <script src="https://cdn.jsdelivr.net/npm/jquery"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-array"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-geo"></script>
    <link rel="shortcut icon" href="favicon.ico" />
    <style>
        #main {
            width: 800px;
            height: 600px;
            position: absolute;
            top: 60%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
    </style>
</head>

<body>

    <div id="navbar-container">
        <!-- 导航栏 -->
    </div>

    <script>
        // 使用 JavaScript 加载导航栏内容
        window.addEventListener('DOMContentLoaded', function () {
            var navbarContainer = document.getElementById('navbar-container');
            var xhr = new XMLHttpRequest();
            xhr.open('GET', './navgeo.html', true);
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    navbarContainer.innerHTML = xhr.responseText;
                }
            };
            xhr.send();
        });
    </script>

    <div id="main" style="width: 800px; height: 400px;"></div>
    <div class="btn-container">
        <button id="switchBtn" class="btn" style="position: fixed;top: 90%;">Change</button>
    </div>
    <script>
        var chartDom = document.getElementById('main');
        var myChart = echarts.init(chartDom);
        var option;

        myChart.showLoading();
        $.get('../static/json/USA.json', function (usaJson) {
            myChart.hideLoading();
            echarts.registerMap('USA', usaJson, {
                Alaska: {
                    // 把阿拉斯加移到美国主大陆左下方
                    left: -131,
                    top: 25,
                    width: 15
                },
                Hawaii: {
                    left: -110,
                    top: 28,
                    width: 5
                },
                'Puerto Rico': {
                    // 波多黎各
                    left: -76,
                    top: 26,
                    width: 2
                }
            });
            var data = [
                { name: 'Alabama', value: 482 },
                { name: 'Alaska', value: 61 },
                { name: 'Arizona', value: 308 },
                { name: 'Arkansas', value: 239 },
                { name: 'California', value: 1395 },
                { name: 'Colorado', value: 251 },
                { name: 'Connecticut', value: 166 },
                { name: 'Delaware', value: 99 },
                { name: 'District of Columbia', value: 196 },
                { name: 'Florida', value: 1202 },
                { name: 'Georgia', value: 760 },
                { name: 'Hawaii', value: 29 },
                { name: 'Idaho', value: 43 },
                { name: 'Illinois', value: 1162 },
                { name: 'Indiana', value: 504 },
                { name: 'Iowa', value: 118 },
                { name: 'Kansas', value: 171 },
                { name: 'Kentucky', value: 287 },
                { name: 'Louisiana', value: 783 },
                { name: 'Maine', value: 51 },
                { name: 'Maryland', value: 547 },
                { name: 'Massachusetts', value: 293 },
                { name: 'Michigan', value: 503 },
                { name: 'Minnesota', value: 131 },
                { name: 'Mississippi', value: 345 },
                { name: 'Missouri', value: 600 },
                { name: 'Montana', value: 41 },
                { name: 'Nebraska', value: 97 },
                { name: 'Nevada', value: 156 },
                { name: 'New Hampshire', value: 44 },
                { name: 'New Jersey', value: 332 },
                { name: 'New Mexico', value: 161 },
                { name: 'New York', value: 657 },
                { name: 'North Carolina', value: 743 },
                { name: 'North Dakota', value: 20 },
                { name: 'Ohio', value: 800 },
                { name: 'Oklahoma', value: 227 },
                { name: 'Oregon', value: 146 },
                { name: 'Pennsylvania', value: 838 },
                { name: 'Rhode Island', value: 39 },
                { name: 'South Carolina', value: 554 },
                { name: 'South Dakota', value: 24 },
                { name: 'Tennessee', value: 671 },
                { name: 'Texas', value: 1426 },
                { name: 'Utah', value: 83 },
                { name: 'Vermont', value: 30 },
                { name: 'Virginia', value: 511 },
                { name: 'Washington', value: 218 },
                { name: 'West Virginia', value: 121 },
                { name: 'Wisconsin', value: 309 },
                { name: 'Wyoming', value: 15 }
            ];
            data.sort(function (a, b) {
                return a.value - b.value;
            });
            const mapOption = {
                title: {
                    text: '美国枪支暴力案数据统计',
                    subtext: 'Data from www.gunviolencearchive.org',
                    sublink: 'https://www.gunviolencearchive.org/',
                    left: 'right',
                    top: '0',
                    textStyle: {
                        fontSize: '16' // 或者 fontSize: '14'
                    }
                },

                visualMap: {
                    left: 'right',
                    min: 0,
                    max: 1500,
                    inRange: {
                        // prettier-ignore
                        color: ['#313695', '#4575b4', '#74add1', '#abd9e9', '#e0f3f8', '#ffffbf', '#fee090', '#fdae61', '#f46d43', '#d73027', '#a50026']
                    },
                    text: ['High', 'Low'],
                    calculable: true
                },
                series: [
                    {
                        id: 'population',
                        type: 'map',
                        roam: false,
                        map: 'USA',
                        animationDurationUpdate: 1000,
                        universalTransition: true,
                        data: data
                    }
                ]
            };
            const barOption = {
                xAxis: {
                    type: 'value'
                },
                yAxis: {
                    type: 'category',
                    axisLabel: {
                        rotate: 30
                    },
                    data: data.map(function (item) {
                        return item.name;
                    })
                },
                animationDurationUpdate: 1000,
                series: {
                    type: 'bar',
                    id: 'population',
                    data: data.map(function (item) {
                        return item.value;
                    }),
                    universalTransition: true,
                    itemStyle: {
                        emphasis: {
                            // 设置柱状图的高亮样式
                            opacity: 1
                        }
                    }

                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross',
                        label: {
                            precision: 0  // 设置数值精度
                        },
                        crossStyle: {
                            color: '#999',
                            type: 'dashed'
                        }
                    },
                    formatter: function (params) {
                        var seriesName = params[0].seriesName;
                        var dataValue = params[0].data;
                        var xAxisName = params[0].axisValue;
                        return xAxisName + ' : ' + dataValue;
                    },
                    textStyle: {
                        fontSize: 12
                    },
                    // backgroundColor: 'rgba(50,50,50,0.7)' // 设置提示框背景颜色和透明度
                }

            };
            let currentOption = mapOption;
            myChart.setOption(mapOption);

            // 获取按钮元素
            var switchBtn = document.getElementById('switchBtn');

            // 添加按钮点击事件监听器
            switchBtn.addEventListener('click', function () {
                // 切换图表
                currentOption = currentOption === mapOption ? barOption : mapOption;
                myChart.setOption(currentOption, true);
            });

        });

        option && myChart.setOption(option);
    </script>

</body>

</html>